
# Power BI Custom Visual — Sankey Diagram (up to 8 levels)

This custom visual renders a multi-level Sankey diagram using a *row–column* (table) data layout. Each row represents a path across up to eight stages (Level1..Level8) with an associated Value.

## Features
- Up to **8 levels** (columns Level1..Level8)
- Table (row–column) input — simple and spreadsheet-like
- Optional tooltip column
- Layout controls: node width, node padding, alignment, label truncation
- Merges identical labels across levels (optional)

## Project Structure
```
powerbi-sankey-8level/
├── assets/icon.png
├── capabilities.json
├── package.json
├── pbiviz.json
├── src/
│   ├── settings.ts
│   └── visual.ts
├── style/visual.less
├── tsconfig.json
└── webpack.config.js
```

## Build & Run
1. Install Node.js (LTS 18+ recommended).
2. Install Power BI visuals tools:
   ```bash
   npm i -g powerbi-visuals-tools
   ```
3. Install dependencies:
   ```bash
   npm install
   ```
4. Start debug server:
   ```bash
   npm run start
   ```
   In Power BI Desktop (Developer mode), import from development server.
5. Package the visual:
   ```bash
   npm run package
   ```
   The `.pbiviz` file appears under `dist/`.

## Data Model (Row–Column)
Create a table with columns:
- **Level1** … **Level8** (text). Use as many as you need; empty cells are allowed.
- **Value** (number) — flow magnitude for the row.
- **Tooltip** (optional text) — will display on hover.

Example:

| Level1 | Level2 | Level3 | Value |
|--------|--------|--------|-------|
| Intake | Triage | Resolve | 120 |
| Intake | Triage | Escalate | 40 |
| Intake | Bypass | Resolve | 10 |

## Notes
- If `mergeSameLabelsAcrossLevels` is **off** (default), stages are unique per level. Turn **on** to merge nodes with identical labels across different levels.
- Alignment options: `left`, `right`, `center`, `justify`.
- Label truncation prevents overlap; adjust `labelMaxLen` in formatting pane.

## Limitations
- This starter uses basic titles for tooltips; for rich tooltips and interactions (cross-filtering, highlighting), consider adding `powerbi-visuals-utils` tooltip and selection helpers.
- Cycles are not supported by Sankey layout.

---
Generated by M365 Copilot.
